<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron√≤fon - La M√†quina del Temps Musical</title>
    <!-- S'ha eliminat la llibreria Tone.js -->
    <style>
        /* Estils generals */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.8s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .game-container {
            max-width: 800px;
            width: 90%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
            transition: all 0.5s ease;
        }

        /* Estils per d√®cades - Variables CSS per a canvis din√†mics */
        .decade-1920s {
            background: linear-gradient(45deg, #000000, #333333);
            color: #f5f5dc;
            font-family: 'Times New Roman', serif;
        }
        .decade-1920s .game-container {
            background: rgba(245, 245, 220, 0.95);
            color: #000;
            border: 3px solid #000;
        }

        .decade-1930s {
            background: linear-gradient(45deg, #8B4513, #DAA520);
            color: #fff;
        }
        .decade-1930s .game-container {
            background: rgba(255, 215, 0, 0.95);
            color: #8B4513;
        }

        .decade-1940s {
            background: linear-gradient(45deg, #2F4F4F, #708090);
            color: #fff;
        }
        .decade-1940s .game-container {
            background: rgba(47, 79, 79, 0.9);
            color: #fff;
        }

        .decade-1950s {
            background: linear-gradient(45deg, #FF6347, #FFD700);
            color: #fff;
        }
        .decade-1950s .game-container {
            background: rgba(255, 99, 71, 0.9);
            color: #fff;
        }

        .decade-1960s {
            background: linear-gradient(45deg, #FF1493, #00CED1);
            color: #fff;
            font-family: 'Arial', sans-serif;
        }
        .decade-1960s .game-container {
            background: rgba(255, 20, 147, 0.9);
            color: #fff;
        }

        .decade-1970s {
            background: linear-gradient(45deg, #8B4513, #CD853F);
            color: #fff;
        }
        .decade-1970s .game-container {
            background: rgba(139, 69, 19, 0.9);
            color: #fff;
        }

        .decade-1980s {
            background: linear-gradient(45deg, #FF00FF, #00FFFF);
            color: #000;
            font-family: 'Courier New', monospace;
        }
        .decade-1980s .game-container {
            background: rgba(255, 0, 255, 0.9);
            color: #00FFFF;
            border: 2px solid #00FFFF;
            box-shadow: 0 0 20px #00FFFF;
        }

        .decade-1990s {
            background: linear-gradient(45deg, #4169E1, #32CD32);
            color: #fff;
        }
        .decade-1990s .game-container {
            background: rgba(65, 105, 225, 0.9);
            color: #fff;
        }

        .decade-2000s {
            background: linear-gradient(45deg, #1a1a1a, #333);
            color: #fff;
            font-family: 'Arial', sans-serif;
        }
        .decade-2000s .game-container {
            background: rgba(26, 26, 26, 0.95);
            color: #fff;
            border: 1px solid #666;
        }
        
        .decade-actualitat {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            color: #fff;
        }
        .decade-actualitat .game-container {
             background: rgba(0, 114, 255, 0.9);
             color: #fff;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .decade-title {
            font-size: 2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .scene-description {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.6;
            font-style: italic;
        }

        .challenge {
            font-size: 1.3em;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .choice-button {
            padding: 15px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 2px solid transparent;
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 1);
        }

        .choice-button:disabled {
            cursor: not-allowed;
        }

        .feedback {
            display: none;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .feedback.correct {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .feedback.incorrect {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .time-travel-indicator {
            background: linear-gradient(90deg, #00d4ff, #0099cc);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-radius: 10px 10px 0 0;
            margin: -40px -40px 20px -40px;
            animation: pulse 2s infinite;
        }

        .mission-briefing {
            background: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 0.9em;
            flex-wrap: wrap;
            gap: 10px;
        }

        .timeline {
            color: #666;
        }

        .score {
            font-size: 1.2em;
            margin: 20px 0;
            font-weight: bold;
        }

        .lives {
            font-size: 1em;
            font-weight: bold;
        }

        .final-screen {
            display: none;
        }

        .final-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #4CAF50;
        }

        .game-over-screen {
            display: none;
        }

        .game-over-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #e74c3c;
        }

        .mission-report {
            background: rgba(76, 175, 80, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4CAF50;
        }

        .mission-report h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .trapped-message {
            background: rgba(231, 76, 60, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e74c3c;
        }

        .trapped-message h3 {
            color: #e74c3c;
            margin-bottom: 15px;
        }

        .final-message {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .restart-button {
            padding: 15px 30px;
            font-size: 1.2em;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .next-button {
            padding: 12px 25px;
            font-size: 1.1em;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .next-button:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .volume-control-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .volume-control-container:hover {
            opacity: 1;
        }

        .volume-control-container span {
            font-size: 1.2em;
            color: white;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100px;
            height: 8px;
            background: #ddd;
            outline: none;
            border-radius: 5px;
            transition: opacity .2s;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }

        #volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes timeWarp {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.05) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .time-warp-effect {
            animation: timeWarp 0.8s ease-in-out;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
                width: 95%;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .decade-title {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Element d'√†udio per reproduir la m√∫sica del joc -->
    <audio id="game-audio" loop></audio>

    <div class="game-container">
        <!-- Pantalla d'inici -->
        <div id="start-screen">
            <h1>‚è∞ CRON√íFON ‚è∞</h1>
            <h2 style="color: #666; margin-bottom: 20px;">La M√†quina del Temps Musical</h2>
            <div style="font-size: 1.1em; margin-bottom: 30px; line-height: 1.8; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                <p><strong>Any 2025, Laboratori d'Ac√∫stica Temporal...</strong></p>
                <p>üì° El Dr. Harmonia ha inventat el <em>Cron√≤fon</em>, una m√†quina que et permet viatjar al passat com a compositor de cinema. Per√≤ hi ha un problema: cada √®poca t√© les seves pr√≤pies regles musicals!</p>
                <p>üé≠ La teva missi√≥ √©s sobreviure a 10 salts temporals diferents, des de 1920 fins al 2025, adaptant-te als estils i tecnologies de cada d√®cada.</p>
                <p>‚ö†Ô∏è <strong>ADVERT√àNCIA:</strong> Si falles 3 vegades, quedar√†s atrapat en el temps per sempre!</p>
            </div>
            <button onclick="startGame()" class="choice-button" style="font-size: 1.3em; padding: 20px 40px; background: linear-gradient(45deg, #4CAF50, #45a049);">
                üöÄ Activar el Cron√≤fon
            </button>
        </div>

        <!-- Pantalla del joc -->
        <div id="game-screen" style="display: none;">
            <div class="time-travel-indicator" id="time-indicator">
                ‚è∞ CRON√íFON ACTIVAT - SALT TEMPORAL EN CURS...
            </div>
            <div class="decade-title" id="decade-title"></div>
            <div class="mission-briefing" id="mission-briefing">
                üé¨ <strong>MISSI√ì:</strong> <span id="scene-description"></span>
            </div>
            <div class="challenge" id="challenge"></div>
            <div class="choices" id="choices"></div>
            <div class="feedback" id="feedback"></div>
            <div class="progress-bar">
                <div class="score" id="score">Missions Completades: 0/10</div>
                <div class="timeline" id="timeline">Prog√©s Temporal: <span id="progress-percentage">0%</span></div>
                <div class="lives" id="lives" style="color: #e74c3c; font-weight: bold;">‚ù§Ô∏è Vides: 3/3</div>
            </div>
        </div>

        <!-- Pantalla de Game Over -->
        <div id="game-over-screen" class="game-over-screen">
            <h2 id="game-over-title">‚è∞üí• ATRAPAT EN EL TEMPS! üí•‚è∞</h2>
            <div class="trapped-message" id="trapped-message">
                <h3>üö® PARADOXA TEMPORAL CR√çTICA DETECTADA</h3>
                <div class="final-message" id="trapped-text"></div>
                <div id="trapped-era" style="margin: 20px 0; font-size: 1.1em;"></div>
                <p style="font-style: italic; margin-top: 20px; color: #666;">
                    ‚ö†Ô∏è El Cron√≤fon s'ha avariat per massa errors temporals. 
                    Has quedat atrapat per sempre en aquesta √®poca!
                </p>
            </div>
            <button onclick="restartGame()" class="restart-button" style="background: #e74c3c;">
                üîÑ Intentar Reparar el Cron√≤fon
            </button>
        </div>

        <!-- Pantalla final -->
        <div id="final-screen" class="final-screen">
            <h2 id="final-title">üéâ MISSI√ì COMPLETA! üéâ</h2>
            <div class="mission-report" id="mission-report">
                <h3>üìä INFORME DE LA MISSI√ì TEMPORAL</h3>
                <div class="final-message" id="final-message"></div>
                <div id="time-mastery" style="margin: 20px 0; font-size: 1.1em;"></div>
                <p style="font-style: italic; margin-top: 20px;">
                    üåü Has demostrat ser un veritable <strong>Mestre del Temps Musical</strong>! 
                    El Dr. Harmonia estaria orgull√≥s.
                </p>
            </div>
            <button onclick="restartGame()" class="restart-button">
                üîÑ Nova Missi√≥ Temporal
            </button>
        </div>
    </div>

    <!-- Control de volum global -->
    <div id="volume-control" class="volume-control-container">
        <span>üîä</span>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
    </div>

    <script>
        /**
         * DADES DEL JOC (AMB ARXIUS DE M√öSICA MP3 A LA CARPETA 'music')
         */
        const etapesHistoriques = [
            { any: "1920 - Era del Cinema Mut", escena: "Has arribat a un cinema de 1920. Charles Chaplin est√† projectant la seva √∫ltima com√®dia i necessita m√∫sica per a una escena de persecuci√≥ de cotxes esbojarrada.", repte: "‚ö° DECISI√ì TEMPORAL: Com crees la m√∫sica per a l'escena?", cssClass: "decade-1920s", intro: "üé© El Cron√≤fon t'ha transportat als rugents anys 20...", choices: [{ text: "üéº Gravo una orquestra simf√≤nica", isCorrect: false, feedback: "‚ùå ERROR TEMPORAL! La tecnologia per a sincronitzar so gravat amb la imatge encara no existia. El Cron√≤fon detecta una paradoxa!" }, { text: "üéπ Escric una partitura per al pianista del cinema", isCorrect: true, feedback: "üéØ √àXIT TEMPORAL! Als anys 20, la m√∫sica era interpretada en directe durant la projecci√≥. Has ent√®s perfectament l'√®poca!" }], musicFile: "music/20s.mp3" },
            { any: "1930 - L'Edat d'Or de Hollywood", escena: "El Cron√≤fon vibra i et porta als estudis de Hollywood. Un director est√† rodant l'entrada triomfal d'un rei al seu castell en una gran producci√≥ √®pica.", repte: "‚ö° MISSI√ì CRITICAL: Quina t√®cnica revolucion√†ria utilitzes?", cssClass: "decade-1930s", intro: "üèõÔ∏è Salts als gloriosos anys 30 de Hollywood...", choices: [{ text: "üé∫ Gran orquestra + melodia associada al rei (leitmotiv)", isCorrect: true, feedback: "üèÜ REVOLUCI√ì MUSICAL DETECTADA! Als anys 30 neix la BSO simf√≤nica i s'importa el leitmotiv de l'√≤pera. Ets un pioner!" }, { text: "üìª La can√ß√≥ de pop m√©s famosa del moment", isCorrect: false, feedback: "‚ö†Ô∏è ANACRONISME DETECTAT! Aquesta pr√†ctica no es popularitzar√† fins d√®cades despr√©s. El temps es resisteix!" }], musicFile: "music/30s.mp3" },
            { any: "1940 - L'Era del Film Noir", escena: "El Cron√≤fon et deixa en un carrer fosc i pluj√≥s. Un detectiu privat camina entre ombres mientras la c√†mera el segueix. L'atmosfera ha de ser urbana i misteriosa.", repte: "üïµÔ∏è INFILTRACI√ì TEMPORAL: Quina m√∫sica tries per sobreviure?", cssClass: "decade-1940s", intro: "üåÉ T'endineixes en les ombres dels anys 40...", choices: [{ text: "ü•Å Marxa militar amb trompetes i timbals", isCorrect: false, feedback: "üö® DETECCI√ì TEMPORAL! Aquesta m√∫sica no encaixa amb l'atmosfera √≠ntima del noir. Ets massa visible!" }, { text: "üé∑ Solo de sax√≤fon amb jazz i blues", isCorrect: true, feedback: "üéØ CAMUFLATJE PERFECTE! El jazz i el blues s'han convertit en el so de la ciutat i el misteri. Passes desapercebut!" }], musicFile: "music/40s.mp3" },
            { any: "1950 - L'Espectacle Cinemascope", escena: "El temps t'arrossega fins a Roma antiga (recreada als estudis). Tens davant la cursa de quadrigues m√©s espectacular mai filmada: Ben-Hur!", repte: "üèõÔ∏è DESAFIAMENT √àPIC: Com representes la grandiositat?", cssClass: "decade-1950s", intro: "üé¨ Arribes a l'era daurada del cinema √®pic...", choices: [{ text: "üé∏ Grup de Rock & Roll", isCorrect: false, feedback: "üé≠ CONTRAST TEMPORAL! Encara que el Rock neix als 50, no s'usa per a √®pica. Massa rebel per a Roma!" }, { text: "üéº Orquestra immensa + cors + percussions brutals", isCorrect: true, feedback: "‚ö° GRANDIOSITAT M√ÄXIMA! Els 50 s√≥n l'era de les partitures grandioses. El teu so omple pantalles gegants!" }], musicFile: "music/50s.mp3" },
            { any: "1960 - La Revoluci√≥ Cultural", escena: "El Cron√≤fon ressona amb energia rebel. Dos joves fugen en moto per la carretera infinita d'Easy Rider. La contracultura est√† naixent!", repte: "‚úä REVOLUCI√ì MUSICAL: Defineix l'esperit rebel de l'√®poca!", cssClass: "decade-1960s", intro: "üèçÔ∏è Cavalques cap als turbulents anys 60...", choices: [{ text: "üéº Pe√ßa cl√†ssica de Bach", isCorrect: false, feedback: "üé© MASSA CONSERVADOR! La joventut et veuria com 'the establishment'. No connectes amb la rebel¬∑lia!" }, { text: "üé∏ Can√ß√≥ de rock de Steppenwolf (Born to be Wild)", isCorrect: true, feedback: "üî• REVOLUCI√ì COMPLETA! Als 60, el rock √©s tan important com l'orquestra. Has capturat l'esperit rebel!" }], musicFile: "music/60s.mp3" },
            { any: "1970 - L'Era dels Blockbusters", escena: "El mar tremola al teu voltant. Un taur√≥ gegant s'acosta a uns banyistes innocents. Steven Spielberg et mira expectant. Cal crear terror absolut!", repte: "ü¶à MISSI√ì SPIELBERG: Com crees tensi√≥ insuportable?", cssClass: "decade-1970s", intro: "üåä Neges en l'era dels grans blockbusters...", choices: [{ text: "üéµ Dues notes greus repetides cada cop m√©s r√†pid", isCorrect: true, feedback: "üèÜ OBRA MESTRA TEMPORAL! Has creat una de les bandes sonores m√©s famoses de la hist√≤ria. John Williams aprovar√†!" }, { text: "üé∑ Jazz relaxat per crear contrast", isCorrect: false, feedback: "üò¥ TENSI√ì PERDUDA! Acabes de trencar la por m√©s ic√≤nica del cinema. Spielberg no ho ent√©n!" }], musicFile: "music/70s.mp3" },
            { any: "1980 - El Futur Electr√≤nic", escena: "Neons rosa i blau t'envolten. Una nau espacial vola sobre un Los Angeles futurista i decadent. Ridley Scott necessita el so del futur mateix!", repte: "üöÄ MISSI√ì BLADE RUNNER: Quina tecnologia domina aquesta era?", cssClass: "decade-1980s", intro: "‚ö° Saltes al futur electr√≤nic dels anys 80...", choices: [{ text: "üéª Orquestra de corda tradicional", isCorrect: false, feedback: "‚è∞ MASSA CL√ÄSSIC! Tot i ser bell, el futur demana nous sons. L'electr√≤nica √©s el cam√≠!" }, { text: "üéπ Sintetitzadors per crear atmosferes alien√≠genes", isCorrect: true, feedback: "üåå FUTUR PERFECTE! Vangelis i tu redefiniu el so de la ci√®ncia-ficci√≥. Els sintetitzadors s√≥n el nou llenguatge!" }], musicFile: "music/80s.mp3" },
            { any: "1990 - L'Era del Mixtape", escena: "Quentin Tarantino et contracta per la seva pel¬∑l√≠cula m√©s ic√≤nica. John Travolta i Uma Thurman estan a punt de ballar. Necessites LA can√ß√≥ perfecta!", repte: "üï∫ MISSI√ì TARANTINO: Qual √©s la seva f√≥rmula secreta?", cssClass: "decade-1990s", intro: "üíø Enters en l'era dorada del mixtape...", choices: [{ text: "üéº Compondre una pe√ßa orquestral original", isCorrect: false, feedback: "üìª NO √âS EL SEU ESTIL! Tarantino √©s el rei de la m√∫sica pop preexistent. Busca en els vinils antics!" }, { text: "üíé Recuperar una joia musical antiga i donar-li nova vida", isCorrect: true, feedback: "üé¨ GENIALITAT TARANTINO! Ets el mestre del 'mixtape cinematogr√†fic'. Les can√ßons del passat reviuen amb nou significat!" }], musicFile: "music/90s.mp3" },
            { any: "2000 - L'√àpica Digital", escena: "El Cron√≤fon et transporta a la Terra Mitjana. Peter Jackson est√† filmant la batalla de Helm's Deep per El Se√±or de los Anillos. Necessita m√∫sica que faci sentir l'√®pica fant√†stica com mai abans!", repte: "‚öîÔ∏è MISSI√ì JACKSON: Com crees l'√®pica del nou mil¬∑lenni?", cssClass: "decade-2000s", intro: "üó°Ô∏è Arribes a l'era de l'√®pica digital...", choices: [{ text: "üéπ Nom√©s sintetitzadors electr√≤nics", isCorrect: false, feedback: "ü§ñ MASSA FUTURISTA! La Terra Mitjana necessita calor hum√†. L'electr√≤nica pura no conecta amb la fantasia!" }, { text: "‚öîÔ∏è Orquestra + cors √®tnics + instruments antics + tecnologia digital", isCorrect: true, feedback: "üèÜ √àPICA PERFECTA! Howard Shore i tu heu creat la simfonia definitiva: tradici√≥ + modernitat. La Terra Mitjana t√© veu!" }], musicFile: "music/2000s.mp3" },
            { any: "Actualitat - L'Era H√≠brida", escena: "Has arribat al present! Una batalla final entre un superheroi i milers de robots. Hans Zimmer et passa el testimoni. √âs la teva prova final!", repte: "ü§ñ MISSI√ì FINAL: Crea el so del segle XXI!", cssClass: "decade-actualitat", intro: "üî• Retornes al present per la batalla definitiva...", choices: [{ text: "üéπ Nom√©s un piano sol", isCorrect: false, feedback: "üòá MASSA MINIMALISTA! Aquesta batalla √®pica demana tot l'arsenal sonor disponible. Pensa en gran!" }, { text: "‚ö° Orquestra + sons electr√≤nics + disseny de so brutal", isCorrect: true, feedback: "üèÜ MESTRE TEMPORAL CONFIRMAT! Has dominat el so h√≠brid modern. El Cron√≤fon reconeix la teva maestria!" }], musicFile: "music/actualitat.mp3" }
        ];

        /**
         * VARIABLES GLOBALS DEL JOC
         */
        let currentLevel = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let gameEnded = false;
        const maxErrors = 3;

        /**
         * ELEMENTS DEL DOM
         */
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const finalScreen = document.getElementById('final-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const decadeTitle = document.getElementById('decade-title');
        const sceneDescription = document.getElementById('scene-description');
        const challenge = document.getElementById('challenge');
        const choicesContainer = document.getElementById('choices');
        const feedback = document.getElementById('feedback');
        const score = document.getElementById('score');
        const lives = document.getElementById('lives');
        const finalMessage = document.getElementById('final-message');
        const volumeSlider = document.getElementById('volume-slider');
        const gameAudio = document.getElementById('game-audio');

        /**
         * INICIA EL JOC
         */
        function startGame() {
            // El clic de l'usuari permetr√† la reproducci√≥ autom√†tica de l'√†udio.
            setGlobalVolume(volumeSlider.value);
            proceedWithGameStart();
        }
        
        function proceedWithGameStart() {
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            currentLevel = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            gameEnded = false;
            
            document.body.classList.add('time-warp-effect');
            setTimeout(() => {
                document.body.classList.remove('time-warp-effect');
                loadLevel();
            }, 800);
        }

        /**
         * FUNCI√ì PER CONTROLAR LA M√öSICA AMB L'ELEMENT <AUDIO>
         * @param {string | null} musicFile - La ruta de l'arxiu MP3, o null per aturar la m√∫sica.
         */
        function switchTrack(musicFile) {
            if (musicFile) {
                gameAudio.src = musicFile;
                // Intentem reproduir la m√∫sica. Els navegadors poden bloquejar-ho si no hi ha interacci√≥ pr√®via.
                const playPromise = gameAudio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error("Error en la reproducci√≥ d'√†udio:", error);
                        // L'usuari haur√† de fer clic per iniciar l'√†udio.
                    });
                }
            } else {
                gameAudio.pause();
                gameAudio.currentTime = 0;
            }
        }

        /**
         * CARREGA UNA MISSI√ì TEMPORAL
         */
        function loadLevel() {
            if (currentLevel >= etapesHistoriques.length) {
                endGame();
                return;
            }

            const etapa = etapesHistoriques[currentLevel];
            
            // Canvia la m√∫sica per a la nova etapa
            switchTrack(etapa.musicFile);

            const timeIndicator = document.getElementById('time-indicator');
            timeIndicator.textContent = etapa.intro || "‚è∞ CRON√íFON ACTIVAT - SALT TEMPORAL EN CURS...";
            timeIndicator.style.animation = 'none';
            timeIndicator.offsetHeight; // Force reflow
            timeIndicator.style.animation = 'pulse 1s ease-in-out';
            
            setTimeout(() => {
                document.body.className = etapa.cssClass;
                decadeTitle.textContent = `üìç DESTINACI√ì: ${etapa.any}`;
                sceneDescription.textContent = etapa.escena;
                challenge.textContent = etapa.repte;
                
                choicesContainer.innerHTML = '';
                etapa.choices.forEach((choice, index) => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.textContent = choice.text;
                    button.onclick = () => selectChoice(index);
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    choicesContainer.appendChild(button);
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.3s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 200 + (index * 100));
                });
                
                feedback.style.display = 'none';
                score.textContent = `Missions Completades: ${correctAnswers}/${etapesHistoriques.length}`;
                
                const remainingLives = maxErrors - incorrectAnswers;
                lives.textContent = `‚ù§Ô∏è Vides: ${remainingLives}/${maxErrors}`;
                if (remainingLives <= 1) {
                    lives.style.color = '#e74c3c';
                    lives.style.animation = 'pulse 1s infinite';
                } else if (remainingLives <= 2) {
                    lives.style.color = '#f39c12';
                } else {
                    lives.style.color = '#27ae60';
                    lives.style.animation = 'none';
                }
                
                const progressPercentage = Math.round((currentLevel / etapesHistoriques.length) * 100);
                document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
                
            }, 500);
        }

        /**
         * GESTIONA LA SELECCI√ì D'UNA OPCI√ì
         */
        function selectChoice(choiceIndex) {
            if (gameEnded) return;
            
            const etapa = etapesHistoriques[currentLevel];
            const selectedChoice = etapa.choices[choiceIndex];
            
            const buttons = choicesContainer.querySelectorAll('.choice-button');
            buttons.forEach((button, index) => {
                button.disabled = true;
                if (index === choiceIndex) {
                    button.style.transform = 'scale(1.05)';
                    button.style.boxShadow = selectedChoice.isCorrect ? 
                        '0 0 20px rgba(76, 175, 80, 0.6)' : 
                        '0 0 20px rgba(244, 67, 54, 0.6)';
                } else {
                    button.style.opacity = '0.5';
                }
            });
            
            setTimeout(() => {
                feedback.textContent = selectedChoice.feedback;
                feedback.className = selectedChoice.isCorrect ? 'feedback correct' : 'feedback incorrect';
                feedback.style.display = 'block';
                feedback.style.opacity = '0';
                feedback.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    feedback.style.transition = 'all 0.5s ease';
                    feedback.style.opacity = '1';
                    feedback.style.transform = 'translateY(0)';
                }, 100);
                
                if (selectedChoice.isCorrect) {
                    correctAnswers++;
                } else {
                    incorrectAnswers++;
                    if (incorrectAnswers >= maxErrors) {
                        setTimeout(() => {
                            gameOver();
                        }, 2000);
                        return;
                    }
                }
                
                const nextButton = document.createElement('button');
                nextButton.className = 'next-button';
                nextButton.textContent = currentLevel === etapesHistoriques.length - 1 ? 
                    'üèÅ Finalitzar Missi√≥ Temporal' : 
                    '‚û°Ô∏è Seg√ºent Salt Temporal';
                nextButton.onclick = nextLevel;
                feedback.appendChild(nextButton);
                
            }, 500);
        }

        /**
         * AVAN√áA AL SEG√úENT NIVELL
         */
        function nextLevel() {
            currentLevel++;
            document.body.classList.add('time-warp-effect');
            setTimeout(() => {
                document.body.classList.remove('time-warp-effect');
                loadLevel();
            }, 800);
        }

        /**
         * GAME OVER
         */
        function gameOver() {
            gameEnded = true;
            switchTrack(null); // Atura la m√∫sica
            gameScreen.style.display = 'none';
            gameOverScreen.style.display = 'block';
            
            let trappedText = '';
            let eraDescription = '';
            const trappedEra = etapesHistoriques[currentLevel];
            
            trappedText = `Has com√®s massa errors temporals i ara est√†s atrapat per sempre a '${trappedEra.any}'! La m√∫sica d'aquesta √®poca ser√† la teva condemna eterna...`;
            eraDescription = `‚è∞ ATRAPAT EN: ${trappedEra.any}`;
            
            document.getElementById('trapped-text').textContent = trappedText;
            document.getElementById('trapped-era').innerHTML = `<strong>Errors Comesos:</strong> ${incorrectAnswers}/${maxErrors}<br><strong>Missions Completades:</strong> ${correctAnswers}/${etapesHistoriques.length}<br><strong>${eraDescription}</strong>`;
            
            gameOverScreen.style.opacity = '0';
            gameOverScreen.style.transform = 'scale(0.9)';
            setTimeout(() => {
                gameOverScreen.style.transition = 'all 0.8s ease';
                gameOverScreen.style.opacity = '1';
                gameOverScreen.style.transform = 'scale(1)';
            }, 200);
        }

        /**
         * FINALITZA EL JOC AMB √àXIT
         */
        function endGame() {
            gameEnded = true;
            switchTrack(null); // Atura la m√∫sica
            gameScreen.style.display = 'none';
            finalScreen.style.display = 'block';
            document.body.className = '';
            
            const percentage = Math.round((correctAnswers / etapesHistoriques.length) * 100);
            let finalTitle = '', finalText = '', masteryLevel = '';
            
            if (percentage === 100) { finalTitle = 'üèÜ MESTRE ABSOLUT DEL TEMPS! üèÜ'; finalText = `Incre√Øble! Has superat totes les ${etapesHistoriques.length} missions amb √®xit total.`; masteryLevel = 'üåü RANG: Crononauta Llegendari'; }
            else if (percentage >= 80) { finalTitle = 'üéâ EXPERT TEMPORAL! üéâ'; finalText = `Excel¬∑lent treball! Has completat ${correctAnswers} de ${etapesHistoriques.length} missions correctament.`; masteryLevel = '‚≠ê RANG: Compositor Temporal Expert'; }
            else { finalTitle = 'üìö APRENENT TEMPORAL üìö'; finalText = `Has completat ${correctAnswers} de ${etapesHistoriques.length} missions. Cada viatge √©s una oportunitat d'aprendre.`; masteryLevel = 'üîπ RANG: Explorador Musical Novell'; }
            
            document.getElementById('final-title').textContent = finalTitle;
            finalMessage.textContent = finalText;
            document.getElementById('time-mastery').innerHTML = `<strong>Puntuaci√≥ Final:</strong> ${correctAnswers}/${etapesHistoriques.length} (${percentage}%)<br><strong>Errors Comesos:</strong> ${incorrectAnswers}/${maxErrors}<br>${masteryLevel}`;
            
            finalScreen.style.opacity = '0';
            finalScreen.style.transform = 'scale(0.9)';
            setTimeout(() => {
                finalScreen.style.transition = 'all 0.8s ease';
                finalScreen.style.opacity = '1';
                finalScreen.style.transform = 'scale(1)';
            }, 200);
        }

        /**
         * REINICIA EL JOC
         */
        function restartGame() {
            switchTrack(null); // Atura la m√∫sica
            currentLevel = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            gameEnded = false;
            finalScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            startScreen.style.display = 'block';
            document.body.className = '';
            
            startScreen.style.opacity = '0';
            startScreen.style.transform = 'translateY(20px)';
            setTimeout(() => {
                startScreen.style.transition = 'all 0.5s ease';
                startScreen.style.opacity = '1';
                startScreen.style.transform = 'translateY(0)';
            }, 100);
        }

        /**
         * AJUSTA EL VOLUM GLOBAL
         */
        function setGlobalVolume(linearVolume) {
            gameAudio.volume = linearVolume;
        }

        // Event listener per al slider de volum
        volumeSlider.addEventListener('input', (e) => {
            setGlobalVolume(e.target.value);
        });

        /**
         * INICIALITZACI√ì DEL JOC
         */
        document.addEventListener('DOMContentLoaded', function() {
            startScreen.style.display = 'block';
            gameScreen.style.display = 'none';
            finalScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            startScreen.style.opacity = '0';
            startScreen.style.transform = 'translateY(30px)';
            setTimeout(() => {
                startScreen.style.transition = 'all 1s ease';
                startScreen.style.opacity = '1';
                startScreen.style.transform = 'translateY(0)';
            }, 300);
        });
    </script>
</body>
</html>
